
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bureau and Bureau Balance data &#8212; Home Credit Default Risk Assessment</title>
    
  <link rel="stylesheet" href="_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/sphinx-book-theme.2d2078699c18a0efb88233928e1cf6ed.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.be0a4a0c39cd630af62a2fcf693f3f06.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="POS Cash balance" href="pos_cash_balance.html" />
    <link rel="prev" title="Process train and test files" href="application_train_test.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  <img src="_static/FORE.jpg" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Home Credit Default Risk Assessment</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="landing-page.html">
   Home Credit Default Risk Assessment
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Get started
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="data_linkages.html">
   Home Credit Default Risk Competition
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data_linkages.html#data">
   Data
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Process train/test
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="application_train_test.html">
   Process train and test files
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Process Bureau data
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Bureau and Bureau Balance data
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Process POS data
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="pos_cash_balance.html">
   POS Cash balance
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Process Earlier applications data
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="previous_applications.html">
   Previous Applications
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Process Credit Card Data
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="credit_card_balance.html">
   Credit Card balance data
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Installments payment data
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="installments_payments.html">
   Install payments
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Merging all processed data
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="join_all_processed.html">
   Joining all processed data
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/bureau.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/bureau.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#feature-explanations">
   Feature explanations
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bureau-table">
     Bureau table
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bureau-balance-table">
     Bureau Balance table
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#aggregation">
   Aggregation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bureau-balance">
   bureau_balance
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#performing-aggregations-in-bb">
   Performing aggregations in bb
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#performing-aggregations-in-bureau">
   Performing aggregations in bureau
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#more-aggregation-and-merger">
   More Aggregation and merger
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="bureau-and-bureau-balance-data">
<h1>Bureau and Bureau Balance data<a class="headerlink" href="#bureau-and-bureau-balance-data" title="Permalink to this headline">¶</a></h1>
<blockquote>*bureau.csv* data concerns client's earlier credits from other financial institutions. Some of the credits may be active and some are closed. Each previous (or ongoing) credit has its own row (only <u>one</u> row per credit) in *bureau* dataset. As a single client might have taken other loans from other financial institutions, for each row in the *application_train* data (ie *application_train.csv*) we can have multiple rows in this table. Feature explanations for this dataset are as below.</blockquote><div class="section" id="feature-explanations">
<h2>Feature explanations<a class="headerlink" href="#feature-explanations" title="Permalink to this headline">¶</a></h2>
<div class="section" id="bureau-table">
<h3>Bureau table<a class="headerlink" href="#bureau-table" title="Permalink to this headline">¶</a></h3>
<blockquote><p style="font-size:13px">
SK_ID_CURR: 	ID of loan in our sample - one loan in our sample can have 0,1,2 or more related previous credits in credit bureau <br>
SK_BUREAU_ID: 	Recoded ID of previous Credit Bureau credit related to our loan (unique coding for each loan application)<br>
CREDIT_ACTIVE: 	Status of the Credit Bureau (CB) reported credits<br>
CREDIT_CURRENCY: 	Recoded currency of the Credit Bureau credit<br>
DAYS_CREDIT: 	How many days before current application did client apply for Credit Bureau credit<br>
CREDIT_DAY_OVERDUE: 	Number of days past due on CB credit at the time of application for related loan in our sample<br>
DAYS_CREDIT_ENDDATE: 	Remaining duration of CB credit (in days) at the time of application in Home Credit<br>
DAYS_ENDDATE_FACT: 	Days since CB credit ended at the time of application in Home Credit (only for closed credit)<br>
AMT_CREDIT_MAX_OVERDUE: 	Maximal amount overdue on the Credit Bureau credit so far (at application date of loan in our sample)<br>
CNT_CREDIT_PROLONG: 	How many times was the Credit Bureau credit prolonged<br>
AMT_CREDIT_SUM: 	Current credit amount for the Credit Bureau credit<br>
AMT_CREDIT_SUM_DEBT: 	Current debt on Credit Bureau credit<br>
AMT_CREDIT_SUM_LIMIT: 	Current credit limit of credit card reported in Credit Bureau<br>
AMT_CREDIT_SUM_OVERDUE: 	Current amount overdue on Credit Bureau credit<br>
CREDIT_TYPE: 	Type of Credit Bureau credit (Car, cash,...)<br>
DAYS_CREDIT_UPDATE: 	How many days before loan application did last information about the Credit Bureau credit come<br>
AMT_ANNUITY: 	Annuity of the Credit Bureau credit<br>
    </p></blockquote>
</div>
<div class="section" id="bureau-balance-table">
<h3>Bureau Balance table<a class="headerlink" href="#bureau-balance-table" title="Permalink to this headline">¶</a></h3>
<blockquote>SK_BUREAU_ID:	Recoded ID of Credit Bureau credit (unique coding for each application) - use this to join to CREDIT_BUREAU table<br>
MONTHS_BALANCE:	Month of balance relative to application date (-1 means the freshest balance date)	time only relative to the application<br>
STATUS:	Status of Credit Bureau loan during the month<br> 	
</blockquote><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Last amended: 21st October, 2020</span>
<span class="c1"># Myfolder: C:\Users\Administrator\OneDrive\Documents\home_credit_default_risk</span>
<span class="c1"># Objective: </span>
<span class="c1">#           Solving Kaggle problem: Home Credit Default Risk</span>
<span class="c1">#           Processing bureau and bureau_balance datasets.</span>
<span class="c1">#</span>
<span class="c1"># Data Source: https://www.kaggle.com/c/home-credit-default-risk/data</span>
<span class="c1"># Ref: https://www.kaggle.com/jsaguiar/lightgbm-with-simple-features</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1.0 Libraries</span>
<span class="c1">#     (Some of these may not be needed here.)</span>
<span class="o">%</span><span class="k">reset</span> -f
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">gc</span>

<span class="c1"># 1.1 Reduce read data size</span>
<span class="c1">#     There is a file reducing.py</span>
<span class="c1">#      in this folder. A class</span>
<span class="c1">#       in it is used to reduce</span>
<span class="c1">#        dataframe size</span>
<span class="c1">#     (Code modified to</span>
<span class="c1">#      exclude &#39;category&#39; dtype)</span>
<span class="kn">import</span> <span class="nn">reducing</span>

<span class="c1"># 1.2 Misc</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1.3</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_colwidth&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1.4 Display multiple commands outputs from a cell</span>
<span class="kn">from</span> <span class="nn">IPython.core.interactiveshell</span> <span class="kn">import</span> <span class="n">InteractiveShell</span>
<span class="n">InteractiveShell</span><span class="o">.</span><span class="n">ast_node_interactivity</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 2.0 One-hot encoding function. Uses pd.get_dummies()</span>
<span class="c1">#     i) To transform &#39;object&#39; columns to dummies. </span>
<span class="c1">#    ii) Treat NaN as one of the categories</span>
<span class="c1">#   iii) Returns transformed-data and new-columns created</span>

<span class="k">def</span> <span class="nf">one_hot_encoder</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">nan_as_category</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="n">original_columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">categorical_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span><span class="p">]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">df</span><span class="p">,</span>
                        <span class="n">columns</span><span class="o">=</span> <span class="n">categorical_columns</span><span class="p">,</span>
                        <span class="n">dummy_na</span><span class="o">=</span> <span class="n">nan_as_category</span>       <span class="c1"># Treat NaNs as category</span>
                       <span class="p">)</span>
    <span class="n">new_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">original_columns</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">df</span><span class="p">,</span> <span class="n">new_columns</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 3.0 Prepare to read data</span>
<span class="n">pathToData</span> <span class="o">=</span> <span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">Users</span><span class="se">\\</span><span class="s2">Administrator</span><span class="se">\\</span><span class="s2">OneDrive</span><span class="se">\\</span><span class="s2">Documents</span><span class="se">\\</span><span class="s2">home_credit_default_risk&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">pathToData</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 3.1 Some constants</span>
<span class="n">num_rows</span><span class="o">=</span><span class="kc">None</span>                <span class="c1"># Implies read all rows</span>
<span class="n">nan_as_category</span> <span class="o">=</span> <span class="kc">True</span>       <span class="c1"># While transforming </span>
                             <span class="c1">#   &#39;object&#39; columns to dummies</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 3.2 Read bureau data first</span>
<span class="n">bureau</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
                     <span class="s1">&#39;bureau.csv.zip&#39;</span><span class="p">,</span>
                     <span class="n">nrows</span> <span class="o">=</span> <span class="kc">None</span>    <span class="c1"># Read all rows</span>
                    <span class="p">)</span>

<span class="c1"># 3.2.1 Reduce memory usage by appropriately</span>
<span class="c1">#       changing data-types per feature:</span>

<span class="n">bureau</span> <span class="o">=</span> <span class="n">reducing</span><span class="o">.</span><span class="n">Reducer</span><span class="p">()</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">bureau</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>reduced df from 222.6203 MB to 165.3284 MB in 1.56 seconds
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 3.2.2 Explore data now</span>
<span class="n">bureau</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">bureau</span><span class="o">.</span><span class="n">shape</span>   <span class="c1"># (rows:17,16,428, cols: 17)</span>
<span class="n">bureau</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SK_ID_CURR</th>
      <th>SK_ID_BUREAU</th>
      <th>CREDIT_ACTIVE</th>
      <th>CREDIT_CURRENCY</th>
      <th>DAYS_CREDIT</th>
      <th>CREDIT_DAY_OVERDUE</th>
      <th>DAYS_CREDIT_ENDDATE</th>
      <th>DAYS_ENDDATE_FACT</th>
      <th>AMT_CREDIT_MAX_OVERDUE</th>
      <th>CNT_CREDIT_PROLONG</th>
      <th>AMT_CREDIT_SUM</th>
      <th>AMT_CREDIT_SUM_DEBT</th>
      <th>AMT_CREDIT_SUM_LIMIT</th>
      <th>AMT_CREDIT_SUM_OVERDUE</th>
      <th>CREDIT_TYPE</th>
      <th>DAYS_CREDIT_UPDATE</th>
      <th>AMT_ANNUITY</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>215354</td>
      <td>5714462</td>
      <td>Closed</td>
      <td>currency 1</td>
      <td>-497</td>
      <td>0</td>
      <td>-153.0</td>
      <td>-153.0</td>
      <td>NaN</td>
      <td>0</td>
      <td>91323.0</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>Consumer credit</td>
      <td>-131</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>215354</td>
      <td>5714463</td>
      <td>Active</td>
      <td>currency 1</td>
      <td>-208</td>
      <td>0</td>
      <td>1075.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>225000.0</td>
      <td>171342.0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>Credit card</td>
      <td>-20</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>215354</td>
      <td>5714464</td>
      <td>Active</td>
      <td>currency 1</td>
      <td>-203</td>
      <td>0</td>
      <td>528.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>464323.5</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>Consumer credit</td>
      <td>-16</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>215354</td>
      <td>5714465</td>
      <td>Active</td>
      <td>currency 1</td>
      <td>-203</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>90000.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>Credit card</td>
      <td>-16</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>215354</td>
      <td>5714466</td>
      <td>Active</td>
      <td>currency 1</td>
      <td>-629</td>
      <td>0</td>
      <td>1197.0</td>
      <td>NaN</td>
      <td>77674.5</td>
      <td>0</td>
      <td>2700000.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>Consumer credit</td>
      <td>-21</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1716428, 17)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SK_ID_CURR                uint32 
SK_ID_BUREAU              uint32 
CREDIT_ACTIVE             object 
CREDIT_CURRENCY           object 
DAYS_CREDIT               int16  
CREDIT_DAY_OVERDUE        uint16 
DAYS_CREDIT_ENDDATE       float64
DAYS_ENDDATE_FACT         float64
AMT_CREDIT_MAX_OVERDUE    float64
CNT_CREDIT_PROLONG        uint8  
AMT_CREDIT_SUM            float64
AMT_CREDIT_SUM_DEBT       float64
AMT_CREDIT_SUM_LIMIT      float64
AMT_CREDIT_SUM_OVERDUE    float32
CREDIT_TYPE               object 
DAYS_CREDIT_UPDATE        int32  
AMT_ANNUITY               float64
dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 3.2.3 In all, how many are categoricals?</span>
<span class="n">bureau</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>float64    7
object     3
uint32     2
float32    1
int32      1
uint16     1
uint8      1
int16      1
dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 3.3</span>
<span class="n">bureau</span><span class="o">.</span><span class="n">shape</span>                       <span class="c1"># (1716428, 17)</span>

<span class="c1"># 3.3.1</span>
<span class="c1"># What is the actual number of persons</span>
<span class="c1">#  who might have taken multiple loans?</span>

<span class="n">bureau</span><span class="p">[</span><span class="s1">&#39;SK_ID_CURR&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>     <span class="c1"># 305811  -- Many duplicate values exist</span>
                                   <span class="c1">#            Consider SK_ID_CURR as Foreign Key</span>
                                   <span class="c1">#            Primary key exists in application_train data</span>
                                   <span class="c1"># Primary key: SK_ID_BUREAU</span>
            
<span class="c1"># 3.3.2</span>
<span class="c1"># As expected, there are no duplicate values here</span>
<span class="n">bureau</span><span class="p">[</span><span class="s1">&#39;SK_ID_BUREAU&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>   <span class="c1"># 1716428 -- Unique id for each row </span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1716428, 17)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>305811
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1716428
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 3.4 Summary of active/closed cases from bureau</span>
<span class="c1"># We aggregate on these also</span>
<span class="n">bureau</span><span class="p">[</span><span class="s1">&#39;CREDIT_ACTIVE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Closed      1079273
Active      630607 
Sold        6527   
Bad debt    21     
Name: CREDIT_ACTIVE, dtype: int64
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="aggregation">
<h2>Aggregation<a class="headerlink" href="#aggregation" title="Permalink to this headline">¶</a></h2>
<blockquote><i>bureau_balance</i> will be aggregated and merged with <i>bureau</i>. <i>bureau</i> will then be aggregated and merged with <i>'application_train'</i> data. <i>bureau</i> will be aggregated in three different ways. This aggregation will be by <i>SK_ID_CURR</i>. Finally, aggregated <i>bureau</i>, called <i>bureau_agg</i>, will be merged with  <i>'application_train'</i> over (<i>SK_ID_CURR</i>).<br>
Aggregation over time is one way to extract behaviour of client. All categorical data is first OneHotEncoded (OHE). What is unique about this OHE is that NaN values are treated as categories. 
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 4.0 OneHotEncode &#39;object&#39; types in bureau</span>
<span class="n">bureau</span><span class="p">,</span> <span class="n">bureau_cat</span> <span class="o">=</span> <span class="n">one_hot_encoder</span><span class="p">(</span><span class="n">bureau</span><span class="p">,</span> <span class="n">nan_as_category</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 4.1</span>
<span class="n">bureau</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">bureau</span><span class="o">.</span><span class="n">shape</span>          <span class="c1"># (1716428, 40); 17--&gt;40</span>
<span class="nb">print</span><span class="p">(</span><span class="n">bureau_cat</span><span class="p">)</span>     <span class="c1"># List of added columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SK_ID_CURR</th>
      <th>SK_ID_BUREAU</th>
      <th>DAYS_CREDIT</th>
      <th>CREDIT_DAY_OVERDUE</th>
      <th>DAYS_CREDIT_ENDDATE</th>
      <th>DAYS_ENDDATE_FACT</th>
      <th>AMT_CREDIT_MAX_OVERDUE</th>
      <th>CNT_CREDIT_PROLONG</th>
      <th>AMT_CREDIT_SUM</th>
      <th>AMT_CREDIT_SUM_DEBT</th>
      <th>...</th>
      <th>CREDIT_TYPE_Loan for business development</th>
      <th>CREDIT_TYPE_Loan for purchase of shares (margin lending)</th>
      <th>CREDIT_TYPE_Loan for the purchase of equipment</th>
      <th>CREDIT_TYPE_Loan for working capital replenishment</th>
      <th>CREDIT_TYPE_Microloan</th>
      <th>CREDIT_TYPE_Mobile operator loan</th>
      <th>CREDIT_TYPE_Mortgage</th>
      <th>CREDIT_TYPE_Real estate loan</th>
      <th>CREDIT_TYPE_Unknown type of loan</th>
      <th>CREDIT_TYPE_nan</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>215354</td>
      <td>5714462</td>
      <td>-497</td>
      <td>0</td>
      <td>-153.0</td>
      <td>-153.0</td>
      <td>NaN</td>
      <td>0</td>
      <td>91323.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>215354</td>
      <td>5714463</td>
      <td>-208</td>
      <td>0</td>
      <td>1075.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>225000.0</td>
      <td>171342.0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>215354</td>
      <td>5714464</td>
      <td>-203</td>
      <td>0</td>
      <td>528.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>464323.5</td>
      <td>NaN</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>215354</td>
      <td>5714465</td>
      <td>-203</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>90000.0</td>
      <td>NaN</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>215354</td>
      <td>5714466</td>
      <td>-629</td>
      <td>0</td>
      <td>1197.0</td>
      <td>NaN</td>
      <td>77674.5</td>
      <td>0</td>
      <td>2700000.0</td>
      <td>NaN</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 40 columns</p>
</div></div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1716428, 40)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;CREDIT_ACTIVE_Active&#39;, &#39;CREDIT_ACTIVE_Bad debt&#39;, &#39;CREDIT_ACTIVE_Closed&#39;, &#39;CREDIT_ACTIVE_Sold&#39;, &#39;CREDIT_ACTIVE_nan&#39;, &#39;CREDIT_CURRENCY_currency 1&#39;, &#39;CREDIT_CURRENCY_currency 2&#39;, &#39;CREDIT_CURRENCY_currency 3&#39;, &#39;CREDIT_CURRENCY_currency 4&#39;, &#39;CREDIT_CURRENCY_nan&#39;, &#39;CREDIT_TYPE_Another type of loan&#39;, &#39;CREDIT_TYPE_Car loan&#39;, &#39;CREDIT_TYPE_Cash loan (non-earmarked)&#39;, &#39;CREDIT_TYPE_Consumer credit&#39;, &#39;CREDIT_TYPE_Credit card&#39;, &#39;CREDIT_TYPE_Interbank credit&#39;, &#39;CREDIT_TYPE_Loan for business development&#39;, &#39;CREDIT_TYPE_Loan for purchase of shares (margin lending)&#39;, &#39;CREDIT_TYPE_Loan for the purchase of equipment&#39;, &#39;CREDIT_TYPE_Loan for working capital replenishment&#39;, &#39;CREDIT_TYPE_Microloan&#39;, &#39;CREDIT_TYPE_Mobile operator loan&#39;, &#39;CREDIT_TYPE_Mortgage&#39;, &#39;CREDIT_TYPE_Real estate loan&#39;, &#39;CREDIT_TYPE_Unknown type of loan&#39;, &#39;CREDIT_TYPE_nan&#39;]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="bureau-balance">
<h2>bureau_balance<a class="headerlink" href="#bureau-balance" title="Permalink to this headline">¶</a></h2>
<blockquote>It is monthly data about the remaining balance of each one of the previous credits of clients that exist in dataset <i>bureau</i>. Each previous credit is identified by a unique ID, <i>SK_ID_BUREAU</i>, in dataset <i>bureau</i>. Each row in <i>bureau_balance</i> is one month of credit-due (from previous credit), and a single previous credit can have multiple rows, one for each month of the credit length.<br> In my personal view, it should be in decreasing order. That is, for every person identified by <i>SK_ID_BUREAU</i>, credits should be decreasing each passing month.</blockquote><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 5.0 Read over bureau_balance data</span>
<span class="c1">#     and reduce memory usage through</span>
<span class="c1">#     conversion of data-types:</span>

<span class="n">bb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;bureau_balance.csv.zip&#39;</span><span class="p">,</span> <span class="n">nrows</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">bb</span> <span class="o">=</span> <span class="n">reducing</span><span class="o">.</span><span class="n">Reducer</span><span class="p">()</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">bb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>reduced df from 624.8458 MB to 338.4582 MB in 4.78 seconds
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 5.0.1 Display few rows </span>
<span class="n">bb</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># 5.0.2 &amp; Compare</span>
<span class="n">bb</span><span class="o">.</span><span class="n">shape</span>      <span class="c1"># (27299925, 3) </span>
<span class="n">bureau</span><span class="o">.</span><span class="n">shape</span>  <span class="c1"># (1716428, 17)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SK_ID_BUREAU</th>
      <th>MONTHS_BALANCE</th>
      <th>STATUS</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5715448</td>
      <td>0</td>
      <td>C</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5715448</td>
      <td>-1</td>
      <td>C</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5715448</td>
      <td>-2</td>
      <td>C</td>
    </tr>
    <tr>
      <th>3</th>
      <td>5715448</td>
      <td>-3</td>
      <td>C</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5715448</td>
      <td>-4</td>
      <td>C</td>
    </tr>
    <tr>
      <th>5</th>
      <td>5715448</td>
      <td>-5</td>
      <td>C</td>
    </tr>
    <tr>
      <th>6</th>
      <td>5715448</td>
      <td>-6</td>
      <td>C</td>
    </tr>
    <tr>
      <th>7</th>
      <td>5715448</td>
      <td>-7</td>
      <td>C</td>
    </tr>
    <tr>
      <th>8</th>
      <td>5715448</td>
      <td>-8</td>
      <td>C</td>
    </tr>
    <tr>
      <th>9</th>
      <td>5715448</td>
      <td>-9</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(27299925, 3)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1716428, 40)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 5.1 There is just one &#39;object&#39; column</span>
<span class="n">bb</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>object    1
int8      1
uint32    1
dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 5.2 Is the data about all bureau cases?</span>
<span class="c1">#      No, it appears it is not for all cases</span>

<span class="n">bb</span><span class="p">[</span><span class="s1">&#39;SK_ID_BUREAU&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>    <span class="c1"># 817395 &lt;&lt; 1716428</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>817395
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 5.3 Just which cases are present in &#39;bureau&#39; but absent</span>
<span class="c1">#     in &#39;bb&#39;</span>
<span class="n">bb_id_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">bb</span><span class="p">[</span><span class="s1">&#39;SK_ID_BUREAU&#39;</span><span class="p">])</span>             <span class="c1"># Set of IDs in bb</span>
<span class="n">bureau_id_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">bureau</span><span class="p">[</span><span class="s1">&#39;SK_ID_BUREAU&#39;</span><span class="p">])</span>     <span class="c1"># Set of IDs in bureau</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 5.4 And here is the difference list.</span>
<span class="c1">#      How many of them? </span>
<span class="nb">list</span><span class="p">(</span><span class="n">bureau_id_set</span> <span class="o">-</span> <span class="n">bb_id_set</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]</span>      <span class="c1"># sample [6292791,6292792,6292793,6292795,6292796,6292797,6292798,6292799]</span>
<span class="nb">len</span><span class="p">(</span><span class="n">bureau_id_set</span> <span class="o">-</span> <span class="n">bb_id_set</span><span class="p">)</span> <span class="c1"># 942074</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[6292791, 6292792, 6292793, 6292795, 6292796]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>942074
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 5.5 OK. So let us OneHotEncode bb</span>
<span class="n">bb</span><span class="p">,</span> <span class="n">bb_cat</span> <span class="o">=</span> <span class="n">one_hot_encoder</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">nan_as_category</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 5.6 Examine the results</span>
<span class="n">bb</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">bb</span><span class="o">.</span><span class="n">shape</span>   <span class="c1"># (27299925, 11) ; 3--&gt;11</span>
           <span class="c1"># 1 (ID) + 1 (numeric) + 9 (dummy)</span>
<span class="n">bb_cat</span>     <span class="c1"># New columns added</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SK_ID_BUREAU</th>
      <th>MONTHS_BALANCE</th>
      <th>STATUS_0</th>
      <th>STATUS_1</th>
      <th>STATUS_2</th>
      <th>STATUS_3</th>
      <th>STATUS_4</th>
      <th>STATUS_5</th>
      <th>STATUS_C</th>
      <th>STATUS_X</th>
      <th>STATUS_nan</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5715448</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5715448</td>
      <td>-1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5715448</td>
      <td>-2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>5715448</td>
      <td>-3</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5715448</td>
      <td>-4</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(27299925, 11)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;STATUS_0&#39;,
 &#39;STATUS_1&#39;,
 &#39;STATUS_2&#39;,
 &#39;STATUS_3&#39;,
 &#39;STATUS_4&#39;,
 &#39;STATUS_5&#39;,
 &#39;STATUS_C&#39;,
 &#39;STATUS_X&#39;,
 &#39;STATUS_nan&#39;]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="performing-aggregations-in-bb">
<h2>Performing aggregations in bb<a class="headerlink" href="#performing-aggregations-in-bb" title="Permalink to this headline">¶</a></h2>
<blockquote>There is one numeric feature: <i>'MONTHS_BALANCE'</i>. On this feature we will perform ['min', 'max', 'size']. And on the rest of the features,dummy features, we will perform [mean]. Aggregation is by unique bureau ID, <i>SK_ID_BUREAU</i>. Resulting dataset is called <i>bureau_agg</i>.</blockquote>  
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 6.0 Bureau balance: Perform aggregations and merge with bureau.csv</span>
<span class="c1">#     First prepare a dictionary listing operations to be performed</span>
<span class="c1">#     on various features:</span>

<span class="n">bb_aggregations</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;MONTHS_BALANCE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">]}</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">bb_cat</span><span class="p">:</span>
    <span class="n">bb_aggregations</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span>

<span class="c1"># 6.0.1    </span>
<span class="nb">len</span><span class="p">(</span><span class="n">bb_aggregations</span><span class="p">)</span>     <span class="c1"># 10  </span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 6.1 So what all aggregations to perform column-wise</span>

<span class="n">bb_aggregations</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;MONTHS_BALANCE&#39;: [&#39;min&#39;, &#39;max&#39;, &#39;size&#39;],
 &#39;STATUS_0&#39;: [&#39;mean&#39;],
 &#39;STATUS_1&#39;: [&#39;mean&#39;],
 &#39;STATUS_2&#39;: [&#39;mean&#39;],
 &#39;STATUS_3&#39;: [&#39;mean&#39;],
 &#39;STATUS_4&#39;: [&#39;mean&#39;],
 &#39;STATUS_5&#39;: [&#39;mean&#39;],
 &#39;STATUS_C&#39;: [&#39;mean&#39;],
 &#39;STATUS_X&#39;: [&#39;mean&#39;],
 &#39;STATUS_nan&#39;: [&#39;mean&#39;]}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 6.2 Perform aggregations now in bb:</span>

<span class="n">grouped</span> <span class="o">=</span>  <span class="n">bb</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;SK_ID_BUREAU&#39;</span><span class="p">)</span>
<span class="n">bb_agg</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;SK_ID_BUREAU&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">bb_aggregations</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 6.3</span>
<span class="n">bb_agg</span><span class="o">.</span><span class="n">shape</span>      <span class="c1"># (817395, 12)</span>
<span class="n">bb_agg</span><span class="o">.</span><span class="n">columns</span>

<span class="c1"># 6.3.1 Note that &#39;SK_ID_BUREAU&#39;</span>
<span class="c1">#       the grouping column is</span>
<span class="c1">#       now table-index</span>

<span class="n">bb_agg</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(817395, 12)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MultiIndex([(&#39;MONTHS_BALANCE&#39;,  &#39;min&#39;),
            (&#39;MONTHS_BALANCE&#39;,  &#39;max&#39;),
            (&#39;MONTHS_BALANCE&#39;, &#39;size&#39;),
            (      &#39;STATUS_0&#39;, &#39;mean&#39;),
            (      &#39;STATUS_1&#39;, &#39;mean&#39;),
            (      &#39;STATUS_2&#39;, &#39;mean&#39;),
            (      &#39;STATUS_3&#39;, &#39;mean&#39;),
            (      &#39;STATUS_4&#39;, &#39;mean&#39;),
            (      &#39;STATUS_5&#39;, &#39;mean&#39;),
            (      &#39;STATUS_C&#39;, &#39;mean&#39;),
            (      &#39;STATUS_X&#39;, &#39;mean&#39;),
            (    &#39;STATUS_nan&#39;, &#39;mean&#39;)],
           )
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="3" halign="left">MONTHS_BALANCE</th>
      <th>STATUS_0</th>
      <th>STATUS_1</th>
      <th>STATUS_2</th>
      <th>STATUS_3</th>
      <th>STATUS_4</th>
      <th>STATUS_5</th>
      <th>STATUS_C</th>
      <th>STATUS_X</th>
      <th>STATUS_nan</th>
    </tr>
    <tr>
      <th></th>
      <th>min</th>
      <th>max</th>
      <th>size</th>
      <th>mean</th>
      <th>mean</th>
      <th>mean</th>
      <th>mean</th>
      <th>mean</th>
      <th>mean</th>
      <th>mean</th>
      <th>mean</th>
      <th>mean</th>
    </tr>
    <tr>
      <th>SK_ID_BUREAU</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>5001709</th>
      <td>-96</td>
      <td>0</td>
      <td>97</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.886598</td>
      <td>0.113402</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5001710</th>
      <td>-82</td>
      <td>0</td>
      <td>83</td>
      <td>0.060241</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.578313</td>
      <td>0.361446</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5001711</th>
      <td>-3</td>
      <td>0</td>
      <td>4</td>
      <td>0.750000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.250000</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5001712</th>
      <td>-18</td>
      <td>0</td>
      <td>19</td>
      <td>0.526316</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.473684</td>
      <td>0.000000</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5001713</th>
      <td>-21</td>
      <td>0</td>
      <td>22</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 6.4 Rename bb_agg columns</span>
<span class="n">bb_agg</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">([</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">bb_agg</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 6.4.1</span>
<span class="n">bb_agg</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">bb_agg</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;MONTHS_BALANCE_MIN&#39;,
 &#39;MONTHS_BALANCE_MAX&#39;,
 &#39;MONTHS_BALANCE_SIZE&#39;,
 &#39;STATUS_0_MEAN&#39;,
 &#39;STATUS_1_MEAN&#39;,
 &#39;STATUS_2_MEAN&#39;,
 &#39;STATUS_3_MEAN&#39;,
 &#39;STATUS_4_MEAN&#39;,
 &#39;STATUS_5_MEAN&#39;,
 &#39;STATUS_C_MEAN&#39;,
 &#39;STATUS_X_MEAN&#39;,
 &#39;STATUS_nan_MEAN&#39;]
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MONTHS_BALANCE_MIN</th>
      <th>MONTHS_BALANCE_MAX</th>
      <th>MONTHS_BALANCE_SIZE</th>
      <th>STATUS_0_MEAN</th>
      <th>STATUS_1_MEAN</th>
      <th>STATUS_2_MEAN</th>
      <th>STATUS_3_MEAN</th>
      <th>STATUS_4_MEAN</th>
      <th>STATUS_5_MEAN</th>
      <th>STATUS_C_MEAN</th>
      <th>STATUS_X_MEAN</th>
      <th>STATUS_nan_MEAN</th>
    </tr>
    <tr>
      <th>SK_ID_BUREAU</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>5001709</th>
      <td>-96</td>
      <td>0</td>
      <td>97</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.886598</td>
      <td>0.113402</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5001710</th>
      <td>-82</td>
      <td>0</td>
      <td>83</td>
      <td>0.060241</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.578313</td>
      <td>0.361446</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5001711</th>
      <td>-3</td>
      <td>0</td>
      <td>4</td>
      <td>0.750000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.250000</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5001712</th>
      <td>-18</td>
      <td>0</td>
      <td>19</td>
      <td>0.526316</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.473684</td>
      <td>0.000000</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5001713</th>
      <td>-21</td>
      <td>0</td>
      <td>22</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 6.5 Merge aggregated bb with bureau</span>

<span class="n">bureau</span> <span class="o">=</span> <span class="n">bureau</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                     <span class="n">bb_agg</span><span class="p">,</span>
                     <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                     <span class="n">on</span><span class="o">=</span><span class="s1">&#39;SK_ID_BUREAU&#39;</span>
                    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 6.5.1</span>

<span class="n">bureau</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">bureau</span><span class="o">.</span><span class="n">shape</span>   <span class="c1"># (1716428, 52)</span>
<span class="n">bureau</span><span class="o">.</span><span class="n">dtypes</span>  
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SK_ID_CURR</th>
      <th>SK_ID_BUREAU</th>
      <th>DAYS_CREDIT</th>
      <th>CREDIT_DAY_OVERDUE</th>
      <th>DAYS_CREDIT_ENDDATE</th>
      <th>DAYS_ENDDATE_FACT</th>
      <th>AMT_CREDIT_MAX_OVERDUE</th>
      <th>CNT_CREDIT_PROLONG</th>
      <th>AMT_CREDIT_SUM</th>
      <th>AMT_CREDIT_SUM_DEBT</th>
      <th>...</th>
      <th>MONTHS_BALANCE_SIZE</th>
      <th>STATUS_0_MEAN</th>
      <th>STATUS_1_MEAN</th>
      <th>STATUS_2_MEAN</th>
      <th>STATUS_3_MEAN</th>
      <th>STATUS_4_MEAN</th>
      <th>STATUS_5_MEAN</th>
      <th>STATUS_C_MEAN</th>
      <th>STATUS_X_MEAN</th>
      <th>STATUS_nan_MEAN</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>215354</td>
      <td>5714462</td>
      <td>-497</td>
      <td>0</td>
      <td>-153.0</td>
      <td>-153.0</td>
      <td>NaN</td>
      <td>0</td>
      <td>91323.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>215354</td>
      <td>5714463</td>
      <td>-208</td>
      <td>0</td>
      <td>1075.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>225000.0</td>
      <td>171342.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>215354</td>
      <td>5714464</td>
      <td>-203</td>
      <td>0</td>
      <td>528.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>464323.5</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>215354</td>
      <td>5714465</td>
      <td>-203</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>90000.0</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>215354</td>
      <td>5714466</td>
      <td>-629</td>
      <td>0</td>
      <td>1197.0</td>
      <td>NaN</td>
      <td>77674.5</td>
      <td>0</td>
      <td>2700000.0</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 52 columns</p>
</div></div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1716428, 52)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SK_ID_CURR                                                  uint32 
SK_ID_BUREAU                                                uint32 
DAYS_CREDIT                                                 int16  
CREDIT_DAY_OVERDUE                                          uint16 
DAYS_CREDIT_ENDDATE                                         float64
DAYS_ENDDATE_FACT                                           float64
AMT_CREDIT_MAX_OVERDUE                                      float64
CNT_CREDIT_PROLONG                                          uint8  
AMT_CREDIT_SUM                                              float64
AMT_CREDIT_SUM_DEBT                                         float64
AMT_CREDIT_SUM_LIMIT                                        float64
AMT_CREDIT_SUM_OVERDUE                                      float32
DAYS_CREDIT_UPDATE                                          int32  
AMT_ANNUITY                                                 float64
CREDIT_ACTIVE_Active                                        uint8  
CREDIT_ACTIVE_Bad debt                                      uint8  
CREDIT_ACTIVE_Closed                                        uint8  
CREDIT_ACTIVE_Sold                                          uint8  
CREDIT_ACTIVE_nan                                           uint8  
CREDIT_CURRENCY_currency 1                                  uint8  
CREDIT_CURRENCY_currency 2                                  uint8  
CREDIT_CURRENCY_currency 3                                  uint8  
CREDIT_CURRENCY_currency 4                                  uint8  
CREDIT_CURRENCY_nan                                         uint8  
CREDIT_TYPE_Another type of loan                            uint8  
CREDIT_TYPE_Car loan                                        uint8  
CREDIT_TYPE_Cash loan (non-earmarked)                       uint8  
CREDIT_TYPE_Consumer credit                                 uint8  
CREDIT_TYPE_Credit card                                     uint8  
CREDIT_TYPE_Interbank credit                                uint8  
CREDIT_TYPE_Loan for business development                   uint8  
CREDIT_TYPE_Loan for purchase of shares (margin lending)    uint8  
CREDIT_TYPE_Loan for the purchase of equipment              uint8  
CREDIT_TYPE_Loan for working capital replenishment          uint8  
CREDIT_TYPE_Microloan                                       uint8  
CREDIT_TYPE_Mobile operator loan                            uint8  
CREDIT_TYPE_Mortgage                                        uint8  
CREDIT_TYPE_Real estate loan                                uint8  
CREDIT_TYPE_Unknown type of loan                            uint8  
CREDIT_TYPE_nan                                             uint8  
MONTHS_BALANCE_MIN                                          float64
MONTHS_BALANCE_MAX                                          float64
MONTHS_BALANCE_SIZE                                         float64
STATUS_0_MEAN                                               float64
STATUS_1_MEAN                                               float64
STATUS_2_MEAN                                               float64
STATUS_3_MEAN                                               float64
STATUS_4_MEAN                                               float64
STATUS_5_MEAN                                               float64
STATUS_C_MEAN                                               float64
STATUS_X_MEAN                                               float64
STATUS_nan_MEAN                                             float64
dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 6.5.2 Just for curiosity, what happened</span>
<span class="c1">#       to those rows in &#39;bureau&#39; where there</span>
<span class="c1">#       was no matching record in bb_agg. The list</span>
<span class="c1">#       of such IDs is:</span>
<span class="c1">#       [6292791,6292792,6292793,6292795,6292796,6292797,6292798,6292799]</span>

<span class="n">bureau</span><span class="p">[</span><span class="n">bureau</span><span class="p">[</span><span class="s1">&#39;SK_ID_BUREAU&#39;</span><span class="p">]</span> <span class="o">==</span><span class="mi">6292791</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SK_ID_CURR</th>
      <th>SK_ID_BUREAU</th>
      <th>DAYS_CREDIT</th>
      <th>CREDIT_DAY_OVERDUE</th>
      <th>DAYS_CREDIT_ENDDATE</th>
      <th>DAYS_ENDDATE_FACT</th>
      <th>AMT_CREDIT_MAX_OVERDUE</th>
      <th>CNT_CREDIT_PROLONG</th>
      <th>AMT_CREDIT_SUM</th>
      <th>AMT_CREDIT_SUM_DEBT</th>
      <th>...</th>
      <th>MONTHS_BALANCE_SIZE</th>
      <th>STATUS_0_MEAN</th>
      <th>STATUS_1_MEAN</th>
      <th>STATUS_2_MEAN</th>
      <th>STATUS_3_MEAN</th>
      <th>STATUS_4_MEAN</th>
      <th>STATUS_5_MEAN</th>
      <th>STATUS_C_MEAN</th>
      <th>STATUS_X_MEAN</th>
      <th>STATUS_nan_MEAN</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>941854</th>
      <td>190757</td>
      <td>6292791</td>
      <td>-707</td>
      <td>0</td>
      <td>-300.0</td>
      <td>-300.0</td>
      <td>0.0</td>
      <td>0</td>
      <td>2250000.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>1 rows × 52 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 6.6 Drop SK_ID_BUREAU as bb has finally merged.</span>

<span class="n">bureau</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;SK_ID_BUREAU&#39;</span><span class="p">],</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">inplace</span><span class="o">=</span> <span class="kc">True</span>
           <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We have three types of columns</span>
<span class="c1"># Categorical columns generated from bureau</span>
<span class="c1"># Categorical columns generated from bb</span>
<span class="c1"># Numerical columns</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="performing-aggregations-in-bureau">
<h2>Performing aggregations in bureau<a class="headerlink" href="#performing-aggregations-in-bureau" title="Permalink to this headline">¶</a></h2>
<blockquote>Aggregate 14 original numeric columns, as: ['min', 'max', 'mean', 'var']<br>
Aggregate rest of the columns that is dummy columns as: [mean]. <br>
This constitutes one of the three aggretaions. Aggregation is by <i>SK_ID_CURR</i>. Resulting dataset is called <i>bureau_agg</i></blockquote><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 7.0 Have a look at bureau again.</span>
<span class="c1">#      SK_ID_CURR repeats for many cases.</span>
<span class="c1">#         So, there is a case for aggregation</span>

<span class="n">bureau</span><span class="o">.</span><span class="n">shape</span>     <span class="c1"># (1716428, 51)</span>
<span class="n">bureau</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1716428, 51)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SK_ID_CURR</th>
      <th>DAYS_CREDIT</th>
      <th>CREDIT_DAY_OVERDUE</th>
      <th>DAYS_CREDIT_ENDDATE</th>
      <th>DAYS_ENDDATE_FACT</th>
      <th>AMT_CREDIT_MAX_OVERDUE</th>
      <th>CNT_CREDIT_PROLONG</th>
      <th>AMT_CREDIT_SUM</th>
      <th>AMT_CREDIT_SUM_DEBT</th>
      <th>AMT_CREDIT_SUM_LIMIT</th>
      <th>...</th>
      <th>MONTHS_BALANCE_SIZE</th>
      <th>STATUS_0_MEAN</th>
      <th>STATUS_1_MEAN</th>
      <th>STATUS_2_MEAN</th>
      <th>STATUS_3_MEAN</th>
      <th>STATUS_4_MEAN</th>
      <th>STATUS_5_MEAN</th>
      <th>STATUS_C_MEAN</th>
      <th>STATUS_X_MEAN</th>
      <th>STATUS_nan_MEAN</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>215354</td>
      <td>-497</td>
      <td>0</td>
      <td>-153.0</td>
      <td>-153.0</td>
      <td>NaN</td>
      <td>0</td>
      <td>91323.0</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>215354</td>
      <td>-208</td>
      <td>0</td>
      <td>1075.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>225000.0</td>
      <td>171342.0</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>215354</td>
      <td>-203</td>
      <td>0</td>
      <td>528.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>464323.5</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>215354</td>
      <td>-203</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>90000.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>215354</td>
      <td>-629</td>
      <td>0</td>
      <td>1197.0</td>
      <td>NaN</td>
      <td>77674.5</td>
      <td>0</td>
      <td>2700000.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 51 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Aggregation strategy</span>
<span class="c1"># 7.1 Numeric features</span>
<span class="c1">#     Columns: Bureau + bureau_balance numeric features</span>
<span class="c1">#              Last three columns are from bureau_balance</span>
<span class="c1">#              Total: 11 + 3 = 14</span>

<span class="n">num_aggregations</span> <span class="o">=</span> <span class="p">{</span>
                     <span class="s1">&#39;DAYS_CREDIT&#39;</span><span class="p">:</span>             <span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;var&#39;</span><span class="p">],</span>
                     <span class="s1">&#39;DAYS_CREDIT_ENDDATE&#39;</span><span class="p">:</span>     <span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">],</span>
                     <span class="s1">&#39;DAYS_CREDIT_UPDATE&#39;</span><span class="p">:</span>      <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">],</span>
                     <span class="s1">&#39;CREDIT_DAY_OVERDUE&#39;</span><span class="p">:</span>      <span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">],</span>
                     <span class="s1">&#39;AMT_CREDIT_MAX_OVERDUE&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">],</span>
                     <span class="s1">&#39;AMT_CREDIT_SUM&#39;</span><span class="p">:</span>          <span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">],</span>
                     <span class="s1">&#39;AMT_CREDIT_SUM_DEBT&#39;</span><span class="p">:</span>     <span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">],</span>
                     <span class="s1">&#39;AMT_CREDIT_SUM_OVERDUE&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">],</span>
                     <span class="s1">&#39;AMT_CREDIT_SUM_LIMIT&#39;</span><span class="p">:</span>    <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">],</span>
                     <span class="s1">&#39;AMT_ANNUITY&#39;</span><span class="p">:</span>             <span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">],</span>
                     <span class="s1">&#39;CNT_CREDIT_PROLONG&#39;</span><span class="p">:</span>      <span class="p">[</span><span class="s1">&#39;sum&#39;</span><span class="p">],</span>
                     <span class="s1">&#39;MONTHS_BALANCE_MIN&#39;</span><span class="p">:</span>      <span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">],</span>
                     <span class="s1">&#39;MONTHS_BALANCE_MAX&#39;</span><span class="p">:</span>      <span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">],</span>
                     <span class="s1">&#39;MONTHS_BALANCE_SIZE&#39;</span><span class="p">:</span>     <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">]</span>
                   <span class="p">}</span>

<span class="nb">len</span><span class="p">(</span><span class="n">num_aggregations</span><span class="p">)</span>   <span class="c1"># 14</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>14
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 7.2 Bureau categorical features. Derived from:</span>
<span class="c1">#       &#39;CREDIT_ACTIVE&#39;, &#39;CREDIT_CURRENCY&#39;, &#39;CREDIT_TYPE&#39;, </span>
<span class="c1">#        Total: </span>

<span class="n">cat_aggregations</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">bureau_cat</span>      <span class="c1"># bureau_cat are newly created dummy columns</span>
                <span class="c1">#  but all are numerical columns</span>

<span class="c1"># 7.2.1    </span>
<span class="nb">len</span><span class="p">(</span><span class="n">bureau_cat</span><span class="p">)</span> <span class="c1"># 26    </span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;CREDIT_ACTIVE_Active&#39;,
 &#39;CREDIT_ACTIVE_Bad debt&#39;,
 &#39;CREDIT_ACTIVE_Closed&#39;,
 &#39;CREDIT_ACTIVE_Sold&#39;,
 &#39;CREDIT_ACTIVE_nan&#39;,
 &#39;CREDIT_CURRENCY_currency 1&#39;,
 &#39;CREDIT_CURRENCY_currency 2&#39;,
 &#39;CREDIT_CURRENCY_currency 3&#39;,
 &#39;CREDIT_CURRENCY_currency 4&#39;,
 &#39;CREDIT_CURRENCY_nan&#39;,
 &#39;CREDIT_TYPE_Another type of loan&#39;,
 &#39;CREDIT_TYPE_Car loan&#39;,
 &#39;CREDIT_TYPE_Cash loan (non-earmarked)&#39;,
 &#39;CREDIT_TYPE_Consumer credit&#39;,
 &#39;CREDIT_TYPE_Credit card&#39;,
 &#39;CREDIT_TYPE_Interbank credit&#39;,
 &#39;CREDIT_TYPE_Loan for business development&#39;,
 &#39;CREDIT_TYPE_Loan for purchase of shares (margin lending)&#39;,
 &#39;CREDIT_TYPE_Loan for the purchase of equipment&#39;,
 &#39;CREDIT_TYPE_Loan for working capital replenishment&#39;,
 &#39;CREDIT_TYPE_Microloan&#39;,
 &#39;CREDIT_TYPE_Mobile operator loan&#39;,
 &#39;CREDIT_TYPE_Mortgage&#39;,
 &#39;CREDIT_TYPE_Real estate loan&#39;,
 &#39;CREDIT_TYPE_Unknown type of loan&#39;,
 &#39;CREDIT_TYPE_nan&#39;]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>26
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 7.2.2 For all these new dummy columns in bureau, we will</span>
<span class="c1">#       take mean</span>
<span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">bureau_cat</span><span class="p">:</span> <span class="n">cat_aggregations</span><span class="p">[</span><span class="n">cat</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span>
<span class="n">cat_aggregations</span>    

<span class="nb">len</span><span class="p">(</span><span class="n">cat_aggregations</span><span class="p">)</span>   <span class="c1"># 26</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;CREDIT_ACTIVE_Active&#39;: [&#39;mean&#39;],
 &#39;CREDIT_ACTIVE_Bad debt&#39;: [&#39;mean&#39;],
 &#39;CREDIT_ACTIVE_Closed&#39;: [&#39;mean&#39;],
 &#39;CREDIT_ACTIVE_Sold&#39;: [&#39;mean&#39;],
 &#39;CREDIT_ACTIVE_nan&#39;: [&#39;mean&#39;],
 &#39;CREDIT_CURRENCY_currency 1&#39;: [&#39;mean&#39;],
 &#39;CREDIT_CURRENCY_currency 2&#39;: [&#39;mean&#39;],
 &#39;CREDIT_CURRENCY_currency 3&#39;: [&#39;mean&#39;],
 &#39;CREDIT_CURRENCY_currency 4&#39;: [&#39;mean&#39;],
 &#39;CREDIT_CURRENCY_nan&#39;: [&#39;mean&#39;],
 &#39;CREDIT_TYPE_Another type of loan&#39;: [&#39;mean&#39;],
 &#39;CREDIT_TYPE_Car loan&#39;: [&#39;mean&#39;],
 &#39;CREDIT_TYPE_Cash loan (non-earmarked)&#39;: [&#39;mean&#39;],
 &#39;CREDIT_TYPE_Consumer credit&#39;: [&#39;mean&#39;],
 &#39;CREDIT_TYPE_Credit card&#39;: [&#39;mean&#39;],
 &#39;CREDIT_TYPE_Interbank credit&#39;: [&#39;mean&#39;],
 &#39;CREDIT_TYPE_Loan for business development&#39;: [&#39;mean&#39;],
 &#39;CREDIT_TYPE_Loan for purchase of shares (margin lending)&#39;: [&#39;mean&#39;],
 &#39;CREDIT_TYPE_Loan for the purchase of equipment&#39;: [&#39;mean&#39;],
 &#39;CREDIT_TYPE_Loan for working capital replenishment&#39;: [&#39;mean&#39;],
 &#39;CREDIT_TYPE_Microloan&#39;: [&#39;mean&#39;],
 &#39;CREDIT_TYPE_Mobile operator loan&#39;: [&#39;mean&#39;],
 &#39;CREDIT_TYPE_Mortgage&#39;: [&#39;mean&#39;],
 &#39;CREDIT_TYPE_Real estate loan&#39;: [&#39;mean&#39;],
 &#39;CREDIT_TYPE_Unknown type of loan&#39;: [&#39;mean&#39;],
 &#39;CREDIT_TYPE_nan&#39;: [&#39;mean&#39;]}
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>26
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 7.3.1 In addition, we have in bureau. columns that merged</span>
<span class="c1">#        from &#39;bb&#39; ie bb_cat</span>
<span class="c1">#         So here is our full list</span>
<span class="n">bb_cat</span>
<span class="nb">len</span><span class="p">(</span><span class="n">bb_cat</span><span class="p">)</span>             <span class="c1"># 9</span>

<span class="c1"># 7.3.2</span>
<span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">bb_cat</span><span class="p">:</span> <span class="n">cat_aggregations</span><span class="p">[</span><span class="n">cat</span> <span class="o">+</span> <span class="s2">&quot;_MEAN&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span>
<span class="n">cat_aggregations</span> 

<span class="nb">len</span><span class="p">(</span><span class="n">cat_aggregations</span><span class="p">)</span>   <span class="c1"># 26 + 9 = 35</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;STATUS_0&#39;,
 &#39;STATUS_1&#39;,
 &#39;STATUS_2&#39;,
 &#39;STATUS_3&#39;,
 &#39;STATUS_4&#39;,
 &#39;STATUS_5&#39;,
 &#39;STATUS_C&#39;,
 &#39;STATUS_X&#39;,
 &#39;STATUS_nan&#39;]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>9
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;CREDIT_ACTIVE_Active&#39;: [&#39;mean&#39;],
 &#39;CREDIT_ACTIVE_Bad debt&#39;: [&#39;mean&#39;],
 &#39;CREDIT_ACTIVE_Closed&#39;: [&#39;mean&#39;],
 &#39;CREDIT_ACTIVE_Sold&#39;: [&#39;mean&#39;],
 &#39;CREDIT_ACTIVE_nan&#39;: [&#39;mean&#39;],
 &#39;CREDIT_CURRENCY_currency 1&#39;: [&#39;mean&#39;],
 &#39;CREDIT_CURRENCY_currency 2&#39;: [&#39;mean&#39;],
 &#39;CREDIT_CURRENCY_currency 3&#39;: [&#39;mean&#39;],
 &#39;CREDIT_CURRENCY_currency 4&#39;: [&#39;mean&#39;],
 &#39;CREDIT_CURRENCY_nan&#39;: [&#39;mean&#39;],
 &#39;CREDIT_TYPE_Another type of loan&#39;: [&#39;mean&#39;],
 &#39;CREDIT_TYPE_Car loan&#39;: [&#39;mean&#39;],
 &#39;CREDIT_TYPE_Cash loan (non-earmarked)&#39;: [&#39;mean&#39;],
 &#39;CREDIT_TYPE_Consumer credit&#39;: [&#39;mean&#39;],
 &#39;CREDIT_TYPE_Credit card&#39;: [&#39;mean&#39;],
 &#39;CREDIT_TYPE_Interbank credit&#39;: [&#39;mean&#39;],
 &#39;CREDIT_TYPE_Loan for business development&#39;: [&#39;mean&#39;],
 &#39;CREDIT_TYPE_Loan for purchase of shares (margin lending)&#39;: [&#39;mean&#39;],
 &#39;CREDIT_TYPE_Loan for the purchase of equipment&#39;: [&#39;mean&#39;],
 &#39;CREDIT_TYPE_Loan for working capital replenishment&#39;: [&#39;mean&#39;],
 &#39;CREDIT_TYPE_Microloan&#39;: [&#39;mean&#39;],
 &#39;CREDIT_TYPE_Mobile operator loan&#39;: [&#39;mean&#39;],
 &#39;CREDIT_TYPE_Mortgage&#39;: [&#39;mean&#39;],
 &#39;CREDIT_TYPE_Real estate loan&#39;: [&#39;mean&#39;],
 &#39;CREDIT_TYPE_Unknown type of loan&#39;: [&#39;mean&#39;],
 &#39;CREDIT_TYPE_nan&#39;: [&#39;mean&#39;],
 &#39;STATUS_0_MEAN&#39;: [&#39;mean&#39;],
 &#39;STATUS_1_MEAN&#39;: [&#39;mean&#39;],
 &#39;STATUS_2_MEAN&#39;: [&#39;mean&#39;],
 &#39;STATUS_3_MEAN&#39;: [&#39;mean&#39;],
 &#39;STATUS_4_MEAN&#39;: [&#39;mean&#39;],
 &#39;STATUS_5_MEAN&#39;: [&#39;mean&#39;],
 &#39;STATUS_C_MEAN&#39;: [&#39;mean&#39;],
 &#39;STATUS_X_MEAN&#39;: [&#39;mean&#39;],
 &#39;STATUS_nan_MEAN&#39;: [&#39;mean&#39;]}
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>35
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 7.4 Have a look at bureau columns again</span>
<span class="c1">#      Just to compare above results with what</span>
<span class="c1">#       already exists</span>

<span class="n">bureau</span><span class="o">.</span><span class="n">columns</span>        <span class="c1"># 51</span>
<span class="nb">len</span><span class="p">(</span><span class="n">bureau</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>   <span class="c1"># 35 (dummy) + 14 (num) + 1 (SK_ID_CURR) + 1 (DAYS_ENDDATE_FACT) = 51</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;SK_ID_CURR&#39;, &#39;DAYS_CREDIT&#39;, &#39;CREDIT_DAY_OVERDUE&#39;,
       &#39;DAYS_CREDIT_ENDDATE&#39;, &#39;DAYS_ENDDATE_FACT&#39;, &#39;AMT_CREDIT_MAX_OVERDUE&#39;,
       &#39;CNT_CREDIT_PROLONG&#39;, &#39;AMT_CREDIT_SUM&#39;, &#39;AMT_CREDIT_SUM_DEBT&#39;,
       &#39;AMT_CREDIT_SUM_LIMIT&#39;, &#39;AMT_CREDIT_SUM_OVERDUE&#39;, &#39;DAYS_CREDIT_UPDATE&#39;,
       &#39;AMT_ANNUITY&#39;, &#39;CREDIT_ACTIVE_Active&#39;, &#39;CREDIT_ACTIVE_Bad debt&#39;,
       &#39;CREDIT_ACTIVE_Closed&#39;, &#39;CREDIT_ACTIVE_Sold&#39;, &#39;CREDIT_ACTIVE_nan&#39;,
       &#39;CREDIT_CURRENCY_currency 1&#39;, &#39;CREDIT_CURRENCY_currency 2&#39;,
       &#39;CREDIT_CURRENCY_currency 3&#39;, &#39;CREDIT_CURRENCY_currency 4&#39;,
       &#39;CREDIT_CURRENCY_nan&#39;, &#39;CREDIT_TYPE_Another type of loan&#39;,
       &#39;CREDIT_TYPE_Car loan&#39;, &#39;CREDIT_TYPE_Cash loan (non-earmarked)&#39;,
       &#39;CREDIT_TYPE_Consumer credit&#39;, &#39;CREDIT_TYPE_Credit card&#39;,
       &#39;CREDIT_TYPE_Interbank credit&#39;,
       &#39;CREDIT_TYPE_Loan for business development&#39;,
       &#39;CREDIT_TYPE_Loan for purchase of shares (margin lending)&#39;,
       &#39;CREDIT_TYPE_Loan for the purchase of equipment&#39;,
       &#39;CREDIT_TYPE_Loan for working capital replenishment&#39;,
       &#39;CREDIT_TYPE_Microloan&#39;, &#39;CREDIT_TYPE_Mobile operator loan&#39;,
       &#39;CREDIT_TYPE_Mortgage&#39;, &#39;CREDIT_TYPE_Real estate loan&#39;,
       &#39;CREDIT_TYPE_Unknown type of loan&#39;, &#39;CREDIT_TYPE_nan&#39;,
       &#39;MONTHS_BALANCE_MIN&#39;, &#39;MONTHS_BALANCE_MAX&#39;, &#39;MONTHS_BALANCE_SIZE&#39;,
       &#39;STATUS_0_MEAN&#39;, &#39;STATUS_1_MEAN&#39;, &#39;STATUS_2_MEAN&#39;, &#39;STATUS_3_MEAN&#39;,
       &#39;STATUS_4_MEAN&#39;, &#39;STATUS_5_MEAN&#39;, &#39;STATUS_C_MEAN&#39;, &#39;STATUS_X_MEAN&#39;,
       &#39;STATUS_nan_MEAN&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>51
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 7.5 Now that we have decided </span>
<span class="c1">#     our aggregation strategy for each column</span>
<span class="c1">#      (except 2), let us now aggregate:</span>
<span class="c1">#         Note that SK_ID_CURR now becomes an index to data</span>

<span class="n">grouped</span> <span class="o">=</span> <span class="n">bureau</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;SK_ID_CURR&#39;</span><span class="p">)</span>
<span class="n">bureau_agg</span> <span class="o">=</span> <span class="n">grouped</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="o">**</span><span class="n">num_aggregations</span><span class="p">,</span> <span class="o">**</span><span class="n">cat_aggregations</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 7.6</span>
<span class="n">bureau_agg</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">bureau_agg</span><span class="o">.</span><span class="n">shape</span>  <span class="c1"># (305811, 62) (including newly created min, max etc columns)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="4" halign="left">DAYS_CREDIT</th>
      <th colspan="3" halign="left">DAYS_CREDIT_ENDDATE</th>
      <th>DAYS_CREDIT_UPDATE</th>
      <th colspan="2" halign="left">CREDIT_DAY_OVERDUE</th>
      <th>...</th>
      <th>CREDIT_TYPE_nan</th>
      <th>STATUS_0_MEAN</th>
      <th>STATUS_1_MEAN</th>
      <th>STATUS_2_MEAN</th>
      <th>STATUS_3_MEAN</th>
      <th>STATUS_4_MEAN</th>
      <th>STATUS_5_MEAN</th>
      <th>STATUS_C_MEAN</th>
      <th>STATUS_X_MEAN</th>
      <th>STATUS_nan_MEAN</th>
    </tr>
    <tr>
      <th></th>
      <th>min</th>
      <th>max</th>
      <th>mean</th>
      <th>var</th>
      <th>min</th>
      <th>max</th>
      <th>mean</th>
      <th>mean</th>
      <th>max</th>
      <th>mean</th>
      <th>...</th>
      <th>mean</th>
      <th>mean</th>
      <th>mean</th>
      <th>mean</th>
      <th>mean</th>
      <th>mean</th>
      <th>mean</th>
      <th>mean</th>
      <th>mean</th>
      <th>mean</th>
    </tr>
    <tr>
      <th>SK_ID_CURR</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>100001</th>
      <td>-1572</td>
      <td>-49</td>
      <td>-735.000000</td>
      <td>240043.666667</td>
      <td>-1329.0</td>
      <td>1778.0</td>
      <td>82.428571</td>
      <td>-93.142857</td>
      <td>0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0</td>
      <td>0.336651</td>
      <td>0.007519</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.441240</td>
      <td>0.214590</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>100002</th>
      <td>-1437</td>
      <td>-103</td>
      <td>-874.000000</td>
      <td>186150.000000</td>
      <td>-1072.0</td>
      <td>780.0</td>
      <td>-349.000000</td>
      <td>-499.875000</td>
      <td>0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0</td>
      <td>0.406960</td>
      <td>0.255682</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.175426</td>
      <td>0.161932</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>100003</th>
      <td>-2586</td>
      <td>-606</td>
      <td>-1400.750000</td>
      <td>827783.583333</td>
      <td>-2434.0</td>
      <td>1216.0</td>
      <td>-544.500000</td>
      <td>-816.000000</td>
      <td>0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>100004</th>
      <td>-1326</td>
      <td>-408</td>
      <td>-867.000000</td>
      <td>421362.000000</td>
      <td>-595.0</td>
      <td>-382.0</td>
      <td>-488.500000</td>
      <td>-532.000000</td>
      <td>0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>100005</th>
      <td>-373</td>
      <td>-62</td>
      <td>-190.666667</td>
      <td>26340.333333</td>
      <td>-128.0</td>
      <td>1324.0</td>
      <td>439.333333</td>
      <td>-54.333333</td>
      <td>0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0</td>
      <td>0.735043</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.128205</td>
      <td>0.136752</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 62 columns</p>
</div></div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(305811, 62)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 7.7 Remove hierarchical index from bureau_agg</span>
<span class="n">bureau_agg</span><span class="o">.</span><span class="n">columns</span>       <span class="c1"># 62 </span>
<span class="n">bureau_agg</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">([</span><span class="s1">&#39;BURO_&#39;</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">bureau_agg</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MultiIndex([(                                             &#39;DAYS_CREDIT&#39;, ...),
            (                                             &#39;DAYS_CREDIT&#39;, ...),
            (                                             &#39;DAYS_CREDIT&#39;, ...),
            (                                             &#39;DAYS_CREDIT&#39;, ...),
            (                                     &#39;DAYS_CREDIT_ENDDATE&#39;, ...),
            (                                     &#39;DAYS_CREDIT_ENDDATE&#39;, ...),
            (                                     &#39;DAYS_CREDIT_ENDDATE&#39;, ...),
            (                                      &#39;DAYS_CREDIT_UPDATE&#39;, ...),
            (                                      &#39;CREDIT_DAY_OVERDUE&#39;, ...),
            (                                      &#39;CREDIT_DAY_OVERDUE&#39;, ...),
            (                                  &#39;AMT_CREDIT_MAX_OVERDUE&#39;, ...),
            (                                          &#39;AMT_CREDIT_SUM&#39;, ...),
            (                                          &#39;AMT_CREDIT_SUM&#39;, ...),
            (                                          &#39;AMT_CREDIT_SUM&#39;, ...),
            (                                     &#39;AMT_CREDIT_SUM_DEBT&#39;, ...),
            (                                     &#39;AMT_CREDIT_SUM_DEBT&#39;, ...),
            (                                     &#39;AMT_CREDIT_SUM_DEBT&#39;, ...),
            (                                  &#39;AMT_CREDIT_SUM_OVERDUE&#39;, ...),
            (                                    &#39;AMT_CREDIT_SUM_LIMIT&#39;, ...),
            (                                    &#39;AMT_CREDIT_SUM_LIMIT&#39;, ...),
            (                                             &#39;AMT_ANNUITY&#39;, ...),
            (                                             &#39;AMT_ANNUITY&#39;, ...),
            (                                      &#39;CNT_CREDIT_PROLONG&#39;, ...),
            (                                      &#39;MONTHS_BALANCE_MIN&#39;, ...),
            (                                      &#39;MONTHS_BALANCE_MAX&#39;, ...),
            (                                     &#39;MONTHS_BALANCE_SIZE&#39;, ...),
            (                                     &#39;MONTHS_BALANCE_SIZE&#39;, ...),
            (                                    &#39;CREDIT_ACTIVE_Active&#39;, ...),
            (                                  &#39;CREDIT_ACTIVE_Bad debt&#39;, ...),
            (                                    &#39;CREDIT_ACTIVE_Closed&#39;, ...),
            (                                      &#39;CREDIT_ACTIVE_Sold&#39;, ...),
            (                                       &#39;CREDIT_ACTIVE_nan&#39;, ...),
            (                              &#39;CREDIT_CURRENCY_currency 1&#39;, ...),
            (                              &#39;CREDIT_CURRENCY_currency 2&#39;, ...),
            (                              &#39;CREDIT_CURRENCY_currency 3&#39;, ...),
            (                              &#39;CREDIT_CURRENCY_currency 4&#39;, ...),
            (                                     &#39;CREDIT_CURRENCY_nan&#39;, ...),
            (                        &#39;CREDIT_TYPE_Another type of loan&#39;, ...),
            (                                    &#39;CREDIT_TYPE_Car loan&#39;, ...),
            (                   &#39;CREDIT_TYPE_Cash loan (non-earmarked)&#39;, ...),
            (                             &#39;CREDIT_TYPE_Consumer credit&#39;, ...),
            (                                 &#39;CREDIT_TYPE_Credit card&#39;, ...),
            (                            &#39;CREDIT_TYPE_Interbank credit&#39;, ...),
            (               &#39;CREDIT_TYPE_Loan for business development&#39;, ...),
            (&#39;CREDIT_TYPE_Loan for purchase of shares (margin lending)&#39;, ...),
            (          &#39;CREDIT_TYPE_Loan for the purchase of equipment&#39;, ...),
            (      &#39;CREDIT_TYPE_Loan for working capital replenishment&#39;, ...),
            (                                   &#39;CREDIT_TYPE_Microloan&#39;, ...),
            (                        &#39;CREDIT_TYPE_Mobile operator loan&#39;, ...),
            (                                    &#39;CREDIT_TYPE_Mortgage&#39;, ...),
            (                            &#39;CREDIT_TYPE_Real estate loan&#39;, ...),
            (                        &#39;CREDIT_TYPE_Unknown type of loan&#39;, ...),
            (                                         &#39;CREDIT_TYPE_nan&#39;, ...),
            (                                           &#39;STATUS_0_MEAN&#39;, ...),
            (                                           &#39;STATUS_1_MEAN&#39;, ...),
            (                                           &#39;STATUS_2_MEAN&#39;, ...),
            (                                           &#39;STATUS_3_MEAN&#39;, ...),
            (                                           &#39;STATUS_4_MEAN&#39;, ...),
            (                                           &#39;STATUS_5_MEAN&#39;, ...),
            (                                           &#39;STATUS_C_MEAN&#39;, ...),
            (                                           &#39;STATUS_X_MEAN&#39;, ...),
            (                                         &#39;STATUS_nan_MEAN&#39;, ...)],
           )
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 7.8</span>
<span class="n">bureau_agg</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="c1"># 7.8.1 Note that SK_ID_CURR is now an index to table</span>
<span class="n">bureau_agg</span><span class="o">.</span><span class="n">columns</span>   <span class="c1"># 62: Due to creation of min, max, var etc columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>BURO_DAYS_CREDIT_MIN</th>
      <th>BURO_DAYS_CREDIT_MAX</th>
      <th>BURO_DAYS_CREDIT_MEAN</th>
      <th>BURO_DAYS_CREDIT_VAR</th>
      <th>BURO_DAYS_CREDIT_ENDDATE_MIN</th>
      <th>BURO_DAYS_CREDIT_ENDDATE_MAX</th>
      <th>BURO_DAYS_CREDIT_ENDDATE_MEAN</th>
      <th>BURO_DAYS_CREDIT_UPDATE_MEAN</th>
      <th>BURO_CREDIT_DAY_OVERDUE_MAX</th>
      <th>BURO_CREDIT_DAY_OVERDUE_MEAN</th>
      <th>...</th>
      <th>BURO_CREDIT_TYPE_nan_MEAN</th>
      <th>BURO_STATUS_0_MEAN_MEAN</th>
      <th>BURO_STATUS_1_MEAN_MEAN</th>
      <th>BURO_STATUS_2_MEAN_MEAN</th>
      <th>BURO_STATUS_3_MEAN_MEAN</th>
      <th>BURO_STATUS_4_MEAN_MEAN</th>
      <th>BURO_STATUS_5_MEAN_MEAN</th>
      <th>BURO_STATUS_C_MEAN_MEAN</th>
      <th>BURO_STATUS_X_MEAN_MEAN</th>
      <th>BURO_STATUS_nan_MEAN_MEAN</th>
    </tr>
    <tr>
      <th>SK_ID_CURR</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>100001</th>
      <td>-1572</td>
      <td>-49</td>
      <td>-735.000000</td>
      <td>240043.666667</td>
      <td>-1329.0</td>
      <td>1778.0</td>
      <td>82.428571</td>
      <td>-93.142857</td>
      <td>0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0</td>
      <td>0.336651</td>
      <td>0.007519</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.441240</td>
      <td>0.214590</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>100002</th>
      <td>-1437</td>
      <td>-103</td>
      <td>-874.000000</td>
      <td>186150.000000</td>
      <td>-1072.0</td>
      <td>780.0</td>
      <td>-349.000000</td>
      <td>-499.875000</td>
      <td>0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0</td>
      <td>0.406960</td>
      <td>0.255682</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.175426</td>
      <td>0.161932</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>100003</th>
      <td>-2586</td>
      <td>-606</td>
      <td>-1400.750000</td>
      <td>827783.583333</td>
      <td>-2434.0</td>
      <td>1216.0</td>
      <td>-544.500000</td>
      <td>-816.000000</td>
      <td>0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>100004</th>
      <td>-1326</td>
      <td>-408</td>
      <td>-867.000000</td>
      <td>421362.000000</td>
      <td>-595.0</td>
      <td>-382.0</td>
      <td>-488.500000</td>
      <td>-532.000000</td>
      <td>0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>100005</th>
      <td>-373</td>
      <td>-62</td>
      <td>-190.666667</td>
      <td>26340.333333</td>
      <td>-128.0</td>
      <td>1324.0</td>
      <td>439.333333</td>
      <td>-54.333333</td>
      <td>0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0</td>
      <td>0.735043</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.128205</td>
      <td>0.136752</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 62 columns</p>
</div></div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;BURO_DAYS_CREDIT_MIN&#39;, &#39;BURO_DAYS_CREDIT_MAX&#39;, &#39;BURO_DAYS_CREDIT_MEAN&#39;,
       &#39;BURO_DAYS_CREDIT_VAR&#39;, &#39;BURO_DAYS_CREDIT_ENDDATE_MIN&#39;,
       &#39;BURO_DAYS_CREDIT_ENDDATE_MAX&#39;, &#39;BURO_DAYS_CREDIT_ENDDATE_MEAN&#39;,
       &#39;BURO_DAYS_CREDIT_UPDATE_MEAN&#39;, &#39;BURO_CREDIT_DAY_OVERDUE_MAX&#39;,
       &#39;BURO_CREDIT_DAY_OVERDUE_MEAN&#39;, &#39;BURO_AMT_CREDIT_MAX_OVERDUE_MEAN&#39;,
       &#39;BURO_AMT_CREDIT_SUM_MAX&#39;, &#39;BURO_AMT_CREDIT_SUM_MEAN&#39;,
       &#39;BURO_AMT_CREDIT_SUM_SUM&#39;, &#39;BURO_AMT_CREDIT_SUM_DEBT_MAX&#39;,
       &#39;BURO_AMT_CREDIT_SUM_DEBT_MEAN&#39;, &#39;BURO_AMT_CREDIT_SUM_DEBT_SUM&#39;,
       &#39;BURO_AMT_CREDIT_SUM_OVERDUE_MEAN&#39;, &#39;BURO_AMT_CREDIT_SUM_LIMIT_MEAN&#39;,
       &#39;BURO_AMT_CREDIT_SUM_LIMIT_SUM&#39;, &#39;BURO_AMT_ANNUITY_MAX&#39;,
       &#39;BURO_AMT_ANNUITY_MEAN&#39;, &#39;BURO_CNT_CREDIT_PROLONG_SUM&#39;,
       &#39;BURO_MONTHS_BALANCE_MIN_MIN&#39;, &#39;BURO_MONTHS_BALANCE_MAX_MAX&#39;,
       &#39;BURO_MONTHS_BALANCE_SIZE_MEAN&#39;, &#39;BURO_MONTHS_BALANCE_SIZE_SUM&#39;,
       &#39;BURO_CREDIT_ACTIVE_Active_MEAN&#39;, &#39;BURO_CREDIT_ACTIVE_Bad debt_MEAN&#39;,
       &#39;BURO_CREDIT_ACTIVE_Closed_MEAN&#39;, &#39;BURO_CREDIT_ACTIVE_Sold_MEAN&#39;,
       &#39;BURO_CREDIT_ACTIVE_nan_MEAN&#39;, &#39;BURO_CREDIT_CURRENCY_currency 1_MEAN&#39;,
       &#39;BURO_CREDIT_CURRENCY_currency 2_MEAN&#39;,
       &#39;BURO_CREDIT_CURRENCY_currency 3_MEAN&#39;,
       &#39;BURO_CREDIT_CURRENCY_currency 4_MEAN&#39;, &#39;BURO_CREDIT_CURRENCY_nan_MEAN&#39;,
       &#39;BURO_CREDIT_TYPE_Another type of loan_MEAN&#39;,
       &#39;BURO_CREDIT_TYPE_Car loan_MEAN&#39;,
       &#39;BURO_CREDIT_TYPE_Cash loan (non-earmarked)_MEAN&#39;,
       &#39;BURO_CREDIT_TYPE_Consumer credit_MEAN&#39;,
       &#39;BURO_CREDIT_TYPE_Credit card_MEAN&#39;,
       &#39;BURO_CREDIT_TYPE_Interbank credit_MEAN&#39;,
       &#39;BURO_CREDIT_TYPE_Loan for business development_MEAN&#39;,
       &#39;BURO_CREDIT_TYPE_Loan for purchase of shares (margin lending)_MEAN&#39;,
       &#39;BURO_CREDIT_TYPE_Loan for the purchase of equipment_MEAN&#39;,
       &#39;BURO_CREDIT_TYPE_Loan for working capital replenishment_MEAN&#39;,
       &#39;BURO_CREDIT_TYPE_Microloan_MEAN&#39;,
       &#39;BURO_CREDIT_TYPE_Mobile operator loan_MEAN&#39;,
       &#39;BURO_CREDIT_TYPE_Mortgage_MEAN&#39;,
       &#39;BURO_CREDIT_TYPE_Real estate loan_MEAN&#39;,
       &#39;BURO_CREDIT_TYPE_Unknown type of loan_MEAN&#39;,
       &#39;BURO_CREDIT_TYPE_nan_MEAN&#39;, &#39;BURO_STATUS_0_MEAN_MEAN&#39;,
       &#39;BURO_STATUS_1_MEAN_MEAN&#39;, &#39;BURO_STATUS_2_MEAN_MEAN&#39;,
       &#39;BURO_STATUS_3_MEAN_MEAN&#39;, &#39;BURO_STATUS_4_MEAN_MEAN&#39;,
       &#39;BURO_STATUS_5_MEAN_MEAN&#39;, &#39;BURO_STATUS_C_MEAN_MEAN&#39;,
       &#39;BURO_STATUS_X_MEAN_MEAN&#39;, &#39;BURO_STATUS_nan_MEAN_MEAN&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 7.9 No duplicate index</span>
<span class="n">bureau_agg</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>   <span class="c1"># 305811</span>
<span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">bureau_agg</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>   <span class="c1"># 305811</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>305811
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>305811
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="more-aggregation-and-merger">
<h2>More Aggregation and merger<a class="headerlink" href="#more-aggregation-and-merger" title="Permalink to this headline">¶</a></h2>
<blockquote>We now filter <i>bureau</i> on <i>CREDIT_ACTIVE_Active</i> feature. This will create two subsets of data. This feature has values of 1 and 0.<br> Filter data where <i>CREDIT_ACTIVE_Active</i> value is 1. Then aggregate(only) numeric features of this filtered data-subset by grouping on <i>SK_ID_CURR</i>. Next, filter, bureau, on <i>CREDIT_ACTIVE_Closed = 1 </i>. And again aggregate the subset on numeric features. Merge all these with <i>bureau_agg</i> (NOT <i>bureau.</i>)<br><br> It is as if we are trying to extract the behaviour of those whose credits are active and those whose credits are closed.</blockquote><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 8.0 In which cases credit is active? Filter data</span>
<span class="n">active</span> <span class="o">=</span> <span class="n">bureau</span><span class="p">[</span><span class="n">bureau</span><span class="p">[</span><span class="s1">&#39;CREDIT_ACTIVE_Active&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">active</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">active</span><span class="o">.</span><span class="n">shape</span>   <span class="c1"># (630607, 51)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SK_ID_CURR</th>
      <th>DAYS_CREDIT</th>
      <th>CREDIT_DAY_OVERDUE</th>
      <th>DAYS_CREDIT_ENDDATE</th>
      <th>DAYS_ENDDATE_FACT</th>
      <th>AMT_CREDIT_MAX_OVERDUE</th>
      <th>CNT_CREDIT_PROLONG</th>
      <th>AMT_CREDIT_SUM</th>
      <th>AMT_CREDIT_SUM_DEBT</th>
      <th>AMT_CREDIT_SUM_LIMIT</th>
      <th>...</th>
      <th>MONTHS_BALANCE_SIZE</th>
      <th>STATUS_0_MEAN</th>
      <th>STATUS_1_MEAN</th>
      <th>STATUS_2_MEAN</th>
      <th>STATUS_3_MEAN</th>
      <th>STATUS_4_MEAN</th>
      <th>STATUS_5_MEAN</th>
      <th>STATUS_C_MEAN</th>
      <th>STATUS_X_MEAN</th>
      <th>STATUS_nan_MEAN</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>215354</td>
      <td>-208</td>
      <td>0</td>
      <td>1075.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>225000.0</td>
      <td>171342.00</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>215354</td>
      <td>-203</td>
      <td>0</td>
      <td>528.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>464323.5</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>215354</td>
      <td>-203</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>90000.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>215354</td>
      <td>-629</td>
      <td>0</td>
      <td>1197.0</td>
      <td>NaN</td>
      <td>77674.5</td>
      <td>0</td>
      <td>2700000.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>5</th>
      <td>215354</td>
      <td>-273</td>
      <td>0</td>
      <td>27460.0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0</td>
      <td>180000.0</td>
      <td>71017.38</td>
      <td>108982.62</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 51 columns</p>
</div></div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(630607, 51)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 8.1 Aggregate numercial features of the filtered subset over SK_ID_CURR</span>
<span class="n">active_agg</span> <span class="o">=</span> <span class="n">active</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;SK_ID_CURR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">num_aggregations</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 8.1.1</span>
<span class="n">active_agg</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">active_agg</span><span class="o">.</span><span class="n">shape</span>   <span class="c1"># (251815, 27)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="4" halign="left">DAYS_CREDIT</th>
      <th colspan="3" halign="left">DAYS_CREDIT_ENDDATE</th>
      <th>DAYS_CREDIT_UPDATE</th>
      <th colspan="2" halign="left">CREDIT_DAY_OVERDUE</th>
      <th>...</th>
      <th>AMT_CREDIT_SUM_OVERDUE</th>
      <th colspan="2" halign="left">AMT_CREDIT_SUM_LIMIT</th>
      <th colspan="2" halign="left">AMT_ANNUITY</th>
      <th>CNT_CREDIT_PROLONG</th>
      <th>MONTHS_BALANCE_MIN</th>
      <th>MONTHS_BALANCE_MAX</th>
      <th colspan="2" halign="left">MONTHS_BALANCE_SIZE</th>
    </tr>
    <tr>
      <th></th>
      <th>min</th>
      <th>max</th>
      <th>mean</th>
      <th>var</th>
      <th>min</th>
      <th>max</th>
      <th>mean</th>
      <th>mean</th>
      <th>max</th>
      <th>mean</th>
      <th>...</th>
      <th>mean</th>
      <th>mean</th>
      <th>sum</th>
      <th>max</th>
      <th>mean</th>
      <th>sum</th>
      <th>min</th>
      <th>max</th>
      <th>mean</th>
      <th>sum</th>
    </tr>
    <tr>
      <th>SK_ID_CURR</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>100001</th>
      <td>-559</td>
      <td>-49</td>
      <td>-309.333333</td>
      <td>65110.333333</td>
      <td>411.0</td>
      <td>1778.0</td>
      <td>1030.333333</td>
      <td>-10.666667</td>
      <td>0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0000</td>
      <td>0.000</td>
      <td>10822.5</td>
      <td>8272.50</td>
      <td>0</td>
      <td>-18.0</td>
      <td>0.0</td>
      <td>10.666667</td>
      <td>32.0</td>
    </tr>
    <tr>
      <th>100002</th>
      <td>-1042</td>
      <td>-103</td>
      <td>-572.500000</td>
      <td>440860.500000</td>
      <td>780.0</td>
      <td>780.0</td>
      <td>780.000000</td>
      <td>-15.500000</td>
      <td>0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>15994.2825</td>
      <td>31988.565</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>0</td>
      <td>-34.0</td>
      <td>0.0</td>
      <td>10.000000</td>
      <td>20.0</td>
    </tr>
    <tr>
      <th>100003</th>
      <td>-606</td>
      <td>-606</td>
      <td>-606.000000</td>
      <td>NaN</td>
      <td>1216.0</td>
      <td>1216.0</td>
      <td>1216.000000</td>
      <td>-43.000000</td>
      <td>0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>810000.0000</td>
      <td>810000.000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>100005</th>
      <td>-137</td>
      <td>-62</td>
      <td>-99.500000</td>
      <td>2812.500000</td>
      <td>122.0</td>
      <td>1324.0</td>
      <td>723.000000</td>
      <td>-21.000000</td>
      <td>0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0000</td>
      <td>0.000</td>
      <td>4261.5</td>
      <td>2130.75</td>
      <td>0</td>
      <td>-4.0</td>
      <td>0.0</td>
      <td>4.000000</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>100008</th>
      <td>-78</td>
      <td>-78</td>
      <td>-78.000000</td>
      <td>NaN</td>
      <td>471.0</td>
      <td>471.0</td>
      <td>471.000000</td>
      <td>-16.000000</td>
      <td>0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0000</td>
      <td>0.000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 27 columns</p>
</div></div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(251815, 27)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 8.1.2 Rename multi-indexed columns</span>
<span class="n">active_agg</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">([</span><span class="s1">&#39;ACTIVE_&#39;</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">active_agg</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()])</span>
<span class="n">active_agg</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;ACTIVE_DAYS_CREDIT_MIN&#39;, &#39;ACTIVE_DAYS_CREDIT_MAX&#39;,
       &#39;ACTIVE_DAYS_CREDIT_MEAN&#39;, &#39;ACTIVE_DAYS_CREDIT_VAR&#39;,
       &#39;ACTIVE_DAYS_CREDIT_ENDDATE_MIN&#39;, &#39;ACTIVE_DAYS_CREDIT_ENDDATE_MAX&#39;,
       &#39;ACTIVE_DAYS_CREDIT_ENDDATE_MEAN&#39;, &#39;ACTIVE_DAYS_CREDIT_UPDATE_MEAN&#39;,
       &#39;ACTIVE_CREDIT_DAY_OVERDUE_MAX&#39;, &#39;ACTIVE_CREDIT_DAY_OVERDUE_MEAN&#39;,
       &#39;ACTIVE_AMT_CREDIT_MAX_OVERDUE_MEAN&#39;, &#39;ACTIVE_AMT_CREDIT_SUM_MAX&#39;,
       &#39;ACTIVE_AMT_CREDIT_SUM_MEAN&#39;, &#39;ACTIVE_AMT_CREDIT_SUM_SUM&#39;,
       &#39;ACTIVE_AMT_CREDIT_SUM_DEBT_MAX&#39;, &#39;ACTIVE_AMT_CREDIT_SUM_DEBT_MEAN&#39;,
       &#39;ACTIVE_AMT_CREDIT_SUM_DEBT_SUM&#39;, &#39;ACTIVE_AMT_CREDIT_SUM_OVERDUE_MEAN&#39;,
       &#39;ACTIVE_AMT_CREDIT_SUM_LIMIT_MEAN&#39;, &#39;ACTIVE_AMT_CREDIT_SUM_LIMIT_SUM&#39;,
       &#39;ACTIVE_AMT_ANNUITY_MAX&#39;, &#39;ACTIVE_AMT_ANNUITY_MEAN&#39;,
       &#39;ACTIVE_CNT_CREDIT_PROLONG_SUM&#39;, &#39;ACTIVE_MONTHS_BALANCE_MIN_MIN&#39;,
       &#39;ACTIVE_MONTHS_BALANCE_MAX_MAX&#39;, &#39;ACTIVE_MONTHS_BALANCE_SIZE_MEAN&#39;,
       &#39;ACTIVE_MONTHS_BALANCE_SIZE_SUM&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 9.0 Difference between length of two datasets</span>
<span class="n">active_agg_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">active_agg</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">bureau_agg_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">bureau_agg</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="nb">len</span><span class="p">(</span><span class="n">bureau_agg_set</span><span class="p">)</span>     <span class="c1"># 305811</span>
<span class="nb">len</span><span class="p">(</span><span class="n">active_agg_set</span><span class="p">)</span>     <span class="c1"># 251815</span>
<span class="nb">list</span><span class="p">(</span><span class="n">bureau_agg_set</span> <span class="o">-</span> <span class="n">active_agg_set</span><span class="p">)[:</span><span class="mi">4</span><span class="p">]</span>   <span class="c1"># Few examples: {131074, 393220, 262149, 262153]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>305811
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>251815
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[131074, 393220, 262149, 262153]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 9.1 Merge bureau_agg with active_agg over &#39;SK_ID_CURR&#39;</span>
<span class="n">bureau_agg</span> <span class="o">=</span> <span class="n">bureau_agg</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                             <span class="n">active_agg</span><span class="p">,</span>
                             <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                             <span class="n">on</span><span class="o">=</span><span class="s1">&#39;SK_ID_CURR&#39;</span>
                             <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 9.2 </span>
<span class="n">bureau_agg</span><span class="o">.</span><span class="n">shape</span>    <span class="c1"># (305811, 89)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(305811, 89)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 9.3 Obviouly some rows will hold NaN values for merged columns</span>
<span class="n">bureau_agg</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="mi">131074</span><span class="p">,</span><span class="mi">393220</span><span class="p">,</span><span class="mi">262149</span><span class="p">,</span> <span class="mi">262153</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>BURO_DAYS_CREDIT_MIN</th>
      <th>BURO_DAYS_CREDIT_MAX</th>
      <th>BURO_DAYS_CREDIT_MEAN</th>
      <th>BURO_DAYS_CREDIT_VAR</th>
      <th>BURO_DAYS_CREDIT_ENDDATE_MIN</th>
      <th>BURO_DAYS_CREDIT_ENDDATE_MAX</th>
      <th>BURO_DAYS_CREDIT_ENDDATE_MEAN</th>
      <th>BURO_DAYS_CREDIT_UPDATE_MEAN</th>
      <th>BURO_CREDIT_DAY_OVERDUE_MAX</th>
      <th>BURO_CREDIT_DAY_OVERDUE_MEAN</th>
      <th>...</th>
      <th>ACTIVE_AMT_CREDIT_SUM_OVERDUE_MEAN</th>
      <th>ACTIVE_AMT_CREDIT_SUM_LIMIT_MEAN</th>
      <th>ACTIVE_AMT_CREDIT_SUM_LIMIT_SUM</th>
      <th>ACTIVE_AMT_ANNUITY_MAX</th>
      <th>ACTIVE_AMT_ANNUITY_MEAN</th>
      <th>ACTIVE_CNT_CREDIT_PROLONG_SUM</th>
      <th>ACTIVE_MONTHS_BALANCE_MIN_MIN</th>
      <th>ACTIVE_MONTHS_BALANCE_MAX_MAX</th>
      <th>ACTIVE_MONTHS_BALANCE_SIZE_MEAN</th>
      <th>ACTIVE_MONTHS_BALANCE_SIZE_SUM</th>
    </tr>
    <tr>
      <th>SK_ID_CURR</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>131074</th>
      <td>-2419</td>
      <td>-2419</td>
      <td>-2419.0</td>
      <td>NaN</td>
      <td>-1301.0</td>
      <td>-1301.0</td>
      <td>-1301.0</td>
      <td>-1707.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>393220</th>
      <td>-478</td>
      <td>-478</td>
      <td>-478.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-288.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>262149</th>
      <td>-373</td>
      <td>-373</td>
      <td>-373.0</td>
      <td>NaN</td>
      <td>-251.0</td>
      <td>-251.0</td>
      <td>-251.0</td>
      <td>-243.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>262153</th>
      <td>-1677</td>
      <td>-1677</td>
      <td>-1677.0</td>
      <td>NaN</td>
      <td>-1589.0</td>
      <td>-1589.0</td>
      <td>-1589.0</td>
      <td>-1012.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>4 rows × 89 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 9.4 Release memory</span>
<span class="k">del</span> <span class="n">active</span><span class="p">,</span> <span class="n">active_agg</span>
<span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>182
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 10.0 Same steps for the  CREDIT_ACTIVE_Closed =1 cases</span>
<span class="c1">#     Bureau: Closed credits - using only numerical aggregations</span>
<span class="n">closed</span> <span class="o">=</span> <span class="n">bureau</span><span class="p">[</span><span class="n">bureau</span><span class="p">[</span><span class="s1">&#39;CREDIT_ACTIVE_Closed&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">closed_agg</span> <span class="o">=</span> <span class="n">closed</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;SK_ID_CURR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">num_aggregations</span><span class="p">)</span>
<span class="n">closed_agg</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">([</span><span class="s1">&#39;CLOSED_&#39;</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">closed_agg</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()])</span>
<span class="n">bureau_agg</span> <span class="o">=</span> <span class="n">bureau_agg</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">closed_agg</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;SK_ID_CURR&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 10.1</span>
<span class="n">bureau_agg</span><span class="o">.</span><span class="n">shape</span>   <span class="c1"># (305811, 116)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(305811, 116)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 10.2</span>
<span class="k">del</span> <span class="n">closed</span><span class="p">,</span> <span class="n">closed_agg</span><span class="p">,</span> <span class="n">bureau</span>
<span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>68
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 10.3 SK_ID_CURR is index. Index is also saved by-default.</span>
<span class="n">bureau_agg</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;processed_bureau_agg.csv.zip&quot;</span><span class="p">,</span> <span class="n">compression</span> <span class="o">=</span> <span class="s2">&quot;zip&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">##################</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="application_train_test.html" title="previous page">Process train and test files</a>
    <a class='right-next' id="next-link" href="pos_cash_balance.html" title="next page">POS Cash balance</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The Jupyter Book community<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>